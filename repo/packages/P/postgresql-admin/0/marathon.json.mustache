{
    "id": "{{service.name}}",
    "cpus": {{postgresql-admin.cpus}},
    "mem": {{postgresql-admin.mem}},
    "instances": 1,
    "env": {
        "POSTGRES_HOST": "{{networking.postgres_host}}.marathon.l4lb.thisdcos.directory",
        "POSTGRES_PORT": "{{networking.postgres_host_port}}",
        "POSTGRES_DEFAULTDB": "{{postgresql-admin.defaultdb}}",
        "APACHE_SERVERNAME": "{{webserver.name}}",
        "APACHE_SERVERADMIN": "{{webserver.server_admin}}",
        "APACHE_DOCUMENTROOT": "{{storage.document_root}}",
        "APACHE_RUN_USER": "{{webserver.run_user}}",
        "APACHE_RUN_GROUP": "{{webserver.run_group}}",
        "APACHE_LOG_DIR": "{{storage.log_dir}}",
        "APACHE_PID_FILE": "{{storage.run_dir}}/apache2.pid",
        "APACHE_RUN_DIR": "{{storage.run_dir}}",
        "APACHE_LOCK_DIR": "{{storage.log_dir}}"
    },
    "container": {
        "type": "DOCKER",
        "volumes": [
        {
          "containerPath": "{{storage.document_root}}",
          {{^storage.persistence}}
          "hostPath": "{{storage.host_volume}}/{{storage.document_root}}",
          {{/storage.persistence}}
          {{#storage.persistence}}
          "persistent": {
            "size": {{storage.volume_size}}
          },
          {{/storage.persistence}}
        "mode": "RW"
        },
        {
          "containerPath": "{{storage.log_dir}}",
          {{^storage.persistence}}
          "hostPath": "{{storage.host_volume}}/{{storage.log_dir}}",
          {{/storage.persistence}}
          {{#storage.persistence}}
          "persistent": {
            "size": {{storage.volume_size}}
          },
          {{/storage.persistence}}
        "mode": "RW"
        },
        {
          "containerPath": "{{storage.run_dir}}",
          {{^storage.persistence}}
          "hostPath": "{{storage.host_volume}}/{{storage.run_dir}}",
          {{/storage.persistence}}
          {{#storage.persistence}}
          "persistent": {
            "size": {{storage.volume_size}}
          },
          {{/storage.persistence}}
        "mode": "RW"
        },
        {
          "containerPath": "{{storage.lock_dir}}",
          {{^storage.persistence}}
          "hostPath": "{{storage.host_volume}}/{{storage.lock_dir}}",
          {{/storage.persistence}}
          {{#storage.persistence}}
          "persistent": {
            "size": {{storage.volume_size}}
          },
          {{/storage.persistence}}
        "mode": "RW"
        }
        ],
        "docker": {
            "image": "{{resource.assets.container.docker.postgresql-admin-docker}}",
            "forcePullImage": false,
            "network": "BRIDGE",
            "portMappings": [
            {
                "containerPort": 80,
                "hostPort": 0,
                "servicePort": {{networking.port_external}}
            }
            ]
        }
    },
    "healthChecks": [
        {
            "protocol": "HTTP",
            "path": "/",
            "portIndex": 0,    
            "gracePeriodSeconds": 300,
            "intervalSeconds": 60,
            "timeoutSeconds": 20,
            "maxConsecutiveFailures": 3
        }
    ],
    "labels": {
        "DCOS_SERVICE_NAME": "{{service.name}}",
        "DCOS_SERVICE_SCHEME": "http",
        "DCOS_SERVICE_PORT_INDEX": "0",
        "DCOS_PACKAGE_NAME": "{{postgresql-admin.name}}",
        "DCOS_PACKAGE_VERSION": "0.1",
        "DCOS_PACKAGE_IS_FRAMEWORK": "true",
        "HAPROXY_GROUP": "external",
        "HAPROXY_0_VHOST": "{{networking.virtual_host}}",
        "DCOS_PACKAGE_FRAMEWORK_NAME": "{{postgresql-admin.name}}"
    }
}
